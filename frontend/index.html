<!doctype html>
<html lang="he" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pizza Shop - EX3</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="bg-slate-50 font-sans leading-normal tracking-normal" dir="rtl">
    <div class="max-w-md mx-auto mt-10 bg-white rounded-xl shadow-lg p-8">
      <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-red-600">ğŸ• ×”×¤×™×¦×” ×©×œ ××ª×Ÿ</h1>
        <p class="text-slate-500 text-sm italic">××¢×¨×›×ª ×”×–×× ×•×ª ×—×›××”</p>
      </div>

      <div class="space-y-5">
        <div>
          <label class="block text-sm font-bold text-slate-700 mb-1"
            >×‘×—×¨ ×¤×™×¦×”</label
          >
          <select
            id="pizzaName"
            onchange="updatePrice()"
            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-red-500 outline-none"
          >
            <option value="" disabled selected>×‘×—×¨ ××”×ª×¤×¨×™×˜...</option>
            <option value="Margherita" data-price="45">××¨×’×¨×™×˜×” (45 â‚ª)</option>
            <option value="Pepperoni" data-price="55">×¤×¤×¨×•× ×™ (55 â‚ª)</option>
            <option value="Greek" data-price="50">×™×•×•× ×™×ª (50 â‚ª)</option>
            <option value="Bianca" data-price="60">×‘×™×× ×§×” (60 â‚ª)</option>
          </select>
        </div>

        <div>
          <label class="block text-sm font-bold text-slate-700 mb-1"
            >×’×•×“×œ</label
          >
          <select
            id="pizzaSize"
            onchange="updatePrice()"
            class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-red-500 outline-none"
          >
            <option value="S">Small (×œ×œ× ×ª×•×¡×¤×ª)</option>
            <option value="M" selected>Medium (+10 â‚ª)</option>
            <option value="L">Large (+20 â‚ª)</option>
          </select>
        </div>

        <div class="bg-red-50 p-3 rounded-lg text-center">
          <span class="text-slate-700 font-medium">××—×™×¨ ×¡×•×¤×™: </span>
          <span id="totalPriceDisplay" class="text-2xl font-bold text-red-600"
            >0</span
          >
          <span class="text-red-600 font-bold"> â‚ª</span>
        </div>

        <div>
          <label class="block text-sm font-bold text-slate-700 mb-1"
            >××™×š ×ª×¨×¦×” ×œ×§×‘×œ ××ª ×”×¤×™×¦×”?</label
          >
          <div class="flex gap-4">
            <label
              class="flex-1 text-center border p-2 rounded-lg cursor-pointer hover:bg-slate-50"
            >
              <input
                type="radio"
                name="deliveryMethod"
                value="Pickup"
                checked
                onclick="toggleDeliveryFields(false)"
              />
              <span class="mr-2">××™×¡×•×£ ×¢×¦××™</span>
            </label>
            <label
              class="flex-1 text-center border p-2 rounded-lg cursor-pointer hover:bg-slate-50"
            >
              <input
                type="radio"
                name="deliveryMethod"
                value="Delivery"
                onclick="toggleDeliveryFields(true)"
              />
              <span class="mr-2">××©×œ×•×—</span>
            </label>
          </div>
        </div>

        <div
          id="deliveryFields"
          class="hidden space-y-3 bg-blue-50 p-4 rounded-lg"
        >
          <input
            id="city"
            type="text"
            placeholder="×¢×™×¨ (×× ×’×œ×™×ª ××•××œ×¥)"
            class="w-full px-3 py-2 border rounded-md outline-none"
          />
          <input
            id="address"
            type="text"
            placeholder="×›×ª×•×‘×ª (×× ×’×œ×™×ª ××•××œ×¥)"
            class="w-full px-3 py-2 border rounded-md outline-none"
          />
          <input
            id="phone"
            type="tel"
            placeholder="××¡×¤×¨ ×˜×œ×¤×•×Ÿ × ×™×™×“"
            class="w-full px-3 py-2 border rounded-md outline-none"
          />
        </div>

        <button
          onclick="placeOrder()"
          class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 rounded-lg shadow-lg transition-all transform active:scale-95"
        >
          ×‘×¦×¢ ×”×–×× ×” ×¢×›×©×™×•
        </button>
      </div>

      <div id="statusMsg" class="mt-4 text-center text-sm font-bold"></div>
    </div>

    <script>
      const MY_TOKEN =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiJtYXRhbjYwMDAzIiwiZXhwIjoxNzcwNDc0NTk4fQ.pPskF4T9QOA358ZrQxwc4CgUoxu-B7zRuixk0ysXxCw";

      function updatePrice() {
        const pizzaSelect = document.getElementById("pizzaName");
        if (!pizzaSelect || pizzaSelect.selectedIndex === -1) return;
        const selectedOption = pizzaSelect.options[pizzaSelect.selectedIndex];
        const basePrice = parseFloat(
          selectedOption.getAttribute("data-price") || 0,
        );
        const size = document.getElementById("pizzaSize").value;
        let sizeExtra = size === "M" ? 10 : size === "L" ? 20 : 0;
        document.getElementById("totalPriceDisplay").innerText =
          basePrice + sizeExtra;
      }

      function toggleDeliveryFields(show) {
        document
          .getElementById("deliveryFields")
          .classList.toggle("hidden", !show);
      }

      async function placeOrder() {
        const statusMsg = document.getElementById("statusMsg");
        const pizzaSelect = document.getElementById("pizzaName");

        const payload = {
          name: pizzaSelect.value,
          size: document.getElementById("pizzaSize").value,
          price: parseFloat(
            document.getElementById("totalPriceDisplay").innerText,
          ),
          delivery_method: document.querySelector(
            'input[name="deliveryMethod"]:checked',
          ).value,
          city: document.getElementById("city").value || null,
          address: document.getElementById("address").value || null,
          phone: document.getElementById("phone").value || null,
        };

        try {
          const response = await fetch("http://localhost:8000/items", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Authorization: "Bearer " + MY_TOKEN.trim(),
            },
            body: JSON.stringify(payload),
          });

          if (response.ok) {
            statusMsg.innerText = "âœ… ×”×”×–×× ×” × ×©×œ×—×” ×‘×”×¦×œ×—×”!";
            statusMsg.className = "mt-4 text-center text-green-600 font-bold";
          } else {
            statusMsg.innerText =
              "âŒ ×©×’×™××ª ××™××•×ª (401) - ×ª×¤×™×§ ×˜×•×§×Ÿ ×—×“×© ×‘-Swagger";
            statusMsg.className = "mt-4 text-center text-red-500 font-bold";
          }
        } catch (err) {
          statusMsg.innerText = "âŒ ××™×Ÿ ×ª×§×©×•×¨×ª ×¢× ×”×©×¨×ª";
          statusMsg.className = "mt-4 text-center text-red-500 font-bold";
        }
      }
    </script>
  </body>
</html>
